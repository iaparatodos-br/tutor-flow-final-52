<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://js.stripe.com https://checkout.stripe.com https://cdn.gpteng.co https://www.googletagmanager.com https://www.google-analytics.com; connect-src 'self' https://nwgomximjevgczwuyqcx.supabase.co wss://nwgomximjevgczwuyqcx.supabase.co https://api.stripe.com https://www.google-analytics.com https://analytics.google.com; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self' data:; object-src 'none'; base-uri 'self'; form-action 'self' https://checkout.stripe.com; upgrade-insecure-requests;">
    <title>TutorFlow - GestÃ£o Completa para Professores Particulares</title>
    <meta name="description" content="Plataforma SaaS para professores particulares gerenciarem alunos, agenda e faturamento. Interface moderna e intuitiva." />
    <meta name="author" content="TutorFlow" />

    <meta property="og:title" content="TutorFlow - GestÃ£o Completa para Professores Particulares" />
    <meta property="og:description" content="Plataforma SaaS para professores particulares gerenciarem alunos, agenda e faturamento. Interface moderna e intuitiva." />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://www.tutor-flow.app/og-image.png" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@tutorflow_app" />
    <meta name="twitter:image" content="https://www.tutor-flow.app/og-image.png" />

    <!-- INTERCEPTAÃ‡ÃƒO DE TOKENS DE RECUPERAÃ‡ÃƒO DE SENHA -->
    <!-- Este script DEVE executar ANTES de qualquer outro JavaScript -->
    <script>
      (function() {
        console.log('ðŸ”‘ [Pre-Init] Verificando tokens de recuperaÃ§Ã£o na URL');
        
        // Capturar URL completa antes do Supabase processar
        const fullUrl = window.location.href;
        console.log('ðŸ”‘ [Pre-Init] URL:', fullUrl);
        
        // Verificar query params e hash
        const searchParams = new URLSearchParams(window.location.search);
        const hashParams = new URLSearchParams(window.location.hash.substring(1));
        
        const accessToken = searchParams.get('access_token') || hashParams.get('access_token');
        const refreshToken = searchParams.get('refresh_token') || hashParams.get('refresh_token');
        const type = searchParams.get('type') || hashParams.get('type');
        
        console.log('ðŸ”‘ [Pre-Init] Tokens detectados:', {
          hasAccessToken: !!accessToken,
          hasRefreshToken: !!refreshToken,
          type: type,
          fromSearch: !!searchParams.get('access_token'),
          fromHash: !!hashParams.get('access_token')
        });
        
        // Se encontramos tokens de recuperaÃ§Ã£o, armazenar E redirecionar imediatamente
        if (accessToken && refreshToken) {
          console.log('ðŸ”‘ [Pre-Init] TOKENS ENCONTRADOS! Salvando e redirecionando...');
          
          // Salvar no sessionStorage
          sessionStorage.setItem('recovery_access_token', accessToken);
          sessionStorage.setItem('recovery_refresh_token', refreshToken);
          sessionStorage.setItem('recovery_type', type || 'recovery');
          sessionStorage.setItem('recovery_url', fullUrl);
          
          // Redirecionar IMEDIATAMENTE para /reset-password com tokens limpos
          // Isso previne o Supabase de processar os tokens
          const resetUrl = '/reset-password?recovery=true';
          console.log('ðŸ”‘ [Pre-Init] Redirecionando para:', resetUrl);
          
          // Usar replace para nÃ£o adicionar ao histÃ³rico
          window.location.replace(resetUrl);
        } else {
          console.log('ðŸ”‘ [Pre-Init] Nenhum token de recuperaÃ§Ã£o detectado, continuando normalmente');
        }
      })();
    </script>

    <!-- Google Analytics (BLOQUEADO atÃ© consentimento) -->
    <!-- Substitua GA_MEASUREMENT_ID pelo ID real quando disponÃ­vel -->
    <!-- <script type="text/plain" data-category="analytics" async src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"></script>
    <script type="text/plain" data-category="analytics">
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'GA_MEASUREMENT_ID', {
        anonymize_ip: true,
        cookie_flags: 'SameSite=None;Secure'
      });
    </script> -->
  </head>

  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
